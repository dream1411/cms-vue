{"version":3,"names":["h","SearchInput","Browser","LoaderView","Header","CloseWrapper","View","packageJson","SearchProviderView","constructor","plugin","opts","defaultOptions","viewType","showTitles","showFilter","showBreadcrumbs","search","bind","triggerSearchInput","addFile","handleScroll","donePicking","render","setPluginState","isInputMode","files","folders","directories","filterInput","currentSelection","searchTerm","tearDown","clearSelection","query","getPluginState","undefined","sharedHandler","loaderWrapper","provider","res","handleError","event","nextPageQuery","shouldHandleScroll","isHandlingScroll","response","error","promises","map","file","Promise","all","state","viewOptions","didFirstRender","preFirstRender","targetViewOptions","loading","isChecked","toggleCheckbox","filterItems","hasInput","browserProps","done","cancel","cancelPicking","headerComponent","i18n","uppy","title","pluginIcon","icon","uppyFiles","getFiles","validateRestrictions","items","forEach","item","push","searchedFor","VERSION","version"],"sources":["SearchProviderView.jsx"],"sourcesContent":["import { h } from 'preact'\n\nimport SearchInput from './InputView.jsx'\nimport Browser from '../Browser.jsx'\nimport LoaderView from '../Loader.jsx'\nimport Header from './Header.jsx'\nimport CloseWrapper from '../CloseWrapper.js'\nimport View from '../View.js'\n\nimport packageJson from '../../package.json'\n\n/**\n * Class to easily generate generic views for Provider plugins\n */\nexport default class SearchProviderView extends View {\n  static VERSION = packageJson.version\n\n  /**\n   * @param {object} plugin instance of the plugin\n   * @param {object} opts\n   */\n  constructor (plugin, opts) {\n    super(plugin, opts)\n\n    // set default options\n    const defaultOptions = {\n      viewType: 'grid',\n      showTitles: false,\n      showFilter: false,\n      showBreadcrumbs: false,\n    }\n\n    // merge default options with the ones set by user\n    this.opts = { ...defaultOptions, ...opts }\n\n    // Logic\n    this.search = this.search.bind(this)\n    this.triggerSearchInput = this.triggerSearchInput.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.handleScroll = this.handleScroll.bind(this)\n    this.donePicking = this.donePicking.bind(this)\n\n    // Visual\n    this.render = this.render.bind(this)\n\n    // Set default state for the plugin\n    this.plugin.setPluginState({\n      isInputMode: true,\n      files: [],\n      folders: [],\n      directories: [],\n      filterInput: '',\n      currentSelection: [],\n      searchTerm: null,\n    })\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  tearDown () {\n    // Nothing.\n  }\n\n  clearSelection () {\n    this.plugin.setPluginState({\n      currentSelection: [],\n      isInputMode: true,\n      files: [],\n      searchTerm: null,\n    })\n  }\n\n  #updateFilesAndInputMode (res, files) {\n    this.nextPageQuery = res.nextPageQuery\n    res.items.forEach((item) => { files.push(item) })\n    this.plugin.setPluginState({\n      isInputMode: false,\n      files,\n      searchTerm: res.searchedFor,\n    })\n  }\n\n  search (query) {\n    const { searchTerm } = this.plugin.getPluginState()\n    if (query && query === searchTerm) {\n      // no need to search again as this is the same as the previous search\n      return undefined\n    }\n\n    return this.sharedHandler.loaderWrapper(\n      this.provider.search(query),\n      (res) => {\n        this.#updateFilesAndInputMode(res, [])\n      },\n      this.handleError,\n    )\n  }\n\n  triggerSearchInput () {\n    this.plugin.setPluginState({ isInputMode: true })\n  }\n\n  async handleScroll (event) {\n    const query = this.nextPageQuery || null\n\n    if (this.shouldHandleScroll(event) && query) {\n      this.isHandlingScroll = true\n\n      try {\n        const { files, searchTerm } = this.plugin.getPluginState()\n        const response = await this.provider.search(searchTerm, query)\n\n        this.#updateFilesAndInputMode(response, files)\n      } catch (error) {\n        this.handleError(error)\n      } finally {\n        this.isHandlingScroll = false\n      }\n    }\n  }\n\n  donePicking () {\n    const { currentSelection } = this.plugin.getPluginState()\n    const promises = currentSelection.map((file) => this.addFile(file))\n\n    this.sharedHandler.loaderWrapper(Promise.all(promises), () => {\n      this.clearSelection()\n    }, () => {})\n  }\n\n  render (state, viewOptions = {}) {\n    const { didFirstRender, isInputMode, searchTerm } = this.plugin.getPluginState()\n\n    if (!didFirstRender) {\n      this.preFirstRender()\n    }\n\n    const targetViewOptions = { ...this.opts, ...viewOptions }\n    const { files, folders, filterInput, loading, currentSelection } = this.plugin.getPluginState()\n    const { isChecked, toggleCheckbox, filterItems } = this.sharedHandler\n    const hasInput = filterInput !== ''\n\n    const browserProps = {\n      isChecked,\n      toggleCheckbox,\n      currentSelection,\n      files: hasInput ? filterItems(files) : files,\n      folders: hasInput ? filterItems(folders) : folders,\n      handleScroll: this.handleScroll,\n      done: this.donePicking,\n      cancel: this.cancelPicking,\n      headerComponent: Header({\n        search: this.search,\n        i18n: this.plugin.uppy.i18n,\n        searchTerm,\n      }),\n      title: this.plugin.title,\n      viewType: targetViewOptions.viewType,\n      showTitles: targetViewOptions.showTitles,\n      showFilter: targetViewOptions.showFilter,\n      showBreadcrumbs: targetViewOptions.showBreadcrumbs,\n      pluginIcon: this.plugin.icon,\n      i18n: this.plugin.uppy.i18n,\n      uppyFiles: this.plugin.uppy.getFiles(),\n      validateRestrictions: (...args) => this.plugin.uppy.validateRestrictions(...args),\n    }\n\n    if (loading) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <LoaderView i18n={this.plugin.uppy.i18n} />\n        </CloseWrapper>\n      )\n    }\n\n    if (isInputMode) {\n      return (\n        <CloseWrapper onUnmount={this.clearSelection}>\n          <SearchInput\n            search={this.search}\n            i18n={this.plugin.uppy.i18n}\n          />\n        </CloseWrapper>\n      )\n    }\n\n    return (\n      <CloseWrapper onUnmount={this.clearSelection}>\n        {/* eslint-disable-next-line react/jsx-props-no-spreading */}\n        <Browser {...browserProps} />\n      </CloseWrapper>\n    )\n  }\n}\n"],"mappings":"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"}