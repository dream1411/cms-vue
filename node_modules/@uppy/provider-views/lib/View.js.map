{"version":3,"names":["getFileType","isPreviewSupported","generateFileID","SharedHandler","View","constructor","plugin","opts","provider","sharedHandler","isHandlingScroll","preFirstRender","bind","handleError","addFile","clearSelection","cancelPicking","providerFileToId","file","data","name","id","type","mimetype","setPluginState","didFirstRender","onFirstRender","shouldHandleScroll","event","scrollHeight","scrollTop","offsetHeight","target","scrollPosition","currentSelection","filterInput","dashboard","uppy","getPlugin","hideAllPanels","error","message","i18n","log","toString","isAuthError","info","details","tagFile","source","mimeType","isRemote","meta","body","fileId","remote","companionUrl","url","fileUrl","requestPath","providerOptions","providerName","fileType","preview","thumbnail","author","authorName","String","authorUrl","err","isRestriction"],"sources":["View.js"],"sourcesContent":["import getFileType from '@uppy/utils/lib/getFileType'\nimport isPreviewSupported from '@uppy/utils/lib/isPreviewSupported'\nimport generateFileID from '@uppy/utils/lib/generateFileID'\n\n// TODO: now that we have a shared `View` class,\n// `SharedHandler` could be cleaned up and moved into here\nimport SharedHandler from './SharedHandler.js'\n\nexport default class View {\n  constructor (plugin, opts) {\n    this.plugin = plugin\n    this.provider = opts.provider\n    this.sharedHandler = new SharedHandler(plugin)\n\n    this.isHandlingScroll = false\n\n    this.preFirstRender = this.preFirstRender.bind(this)\n    this.handleError = this.handleError.bind(this)\n    this.addFile = this.addFile.bind(this)\n    this.clearSelection = this.clearSelection.bind(this)\n    this.cancelPicking = this.cancelPicking.bind(this)\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  providerFileToId (file) {\n    return generateFileID({\n      data: file,\n      name: file.name || file.id,\n      type: file.mimetype,\n    })\n  }\n\n  preFirstRender () {\n    this.plugin.setPluginState({ didFirstRender: true })\n    this.plugin.onFirstRender()\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  shouldHandleScroll (event) {\n    const { scrollHeight, scrollTop, offsetHeight } = event.target\n    const scrollPosition = scrollHeight - (scrollTop + offsetHeight)\n\n    return scrollPosition < 50 && !this.isHandlingScroll\n  }\n\n  clearSelection () {\n    this.plugin.setPluginState({ currentSelection: [], filterInput: '' })\n  }\n\n  cancelPicking () {\n    this.clearSelection()\n\n    const dashboard = this.plugin.uppy.getPlugin('Dashboard')\n\n    if (dashboard) {\n      dashboard.hideAllPanels()\n    }\n  }\n\n  handleError (error) {\n    const { uppy } = this.plugin\n    const message = uppy.i18n('companionError')\n\n    uppy.log(error.toString())\n\n    if (error.isAuthError) {\n      return\n    }\n\n    uppy.info({ message, details: error.toString() }, 'error', 5000)\n  }\n\n  addFile (file) {\n    const tagFile = {\n      id: this.providerFileToId(file),\n      source: this.plugin.id,\n      data: file,\n      name: file.name || file.id,\n      type: file.mimeType,\n      isRemote: true,\n      meta: {},\n      body: {\n        fileId: file.id,\n      },\n      remote: {\n        companionUrl: this.plugin.opts.companionUrl,\n        url: `${this.provider.fileUrl(file.requestPath)}`,\n        body: {\n          fileId: file.id,\n        },\n        providerOptions: this.provider.opts,\n        providerName: this.provider.name,\n      },\n    }\n\n    const fileType = getFileType(tagFile)\n\n    // TODO Should we just always use the thumbnail URL if it exists?\n    if (fileType && isPreviewSupported(fileType)) {\n      tagFile.preview = file.thumbnail\n    }\n\n    if (file.author) {\n      if (file.author.name != null) tagFile.meta.authorName = String(file.author.name)\n      if (file.author.url) tagFile.meta.authorUrl = file.author.url\n    }\n\n    this.plugin.uppy.log('Adding remote file')\n\n    try {\n      this.plugin.uppy.addFile(tagFile)\n      return true\n    } catch (err) {\n      if (!err.isRestriction) {\n        this.plugin.uppy.log(err)\n      }\n      return false\n    }\n  }\n}\n"],"mappings":"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"}