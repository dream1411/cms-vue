{"version":3,"names":["remoteFileObjToLocal","SharedHandler","constructor","plugin","filterItems","bind","toggleCheckbox","recordShiftKeyPress","isChecked","loaderWrapper","items","state","getPluginState","filterInput","filter","folder","name","toLowerCase","indexOf","e","isShiftKeyPressed","shiftKey","file","stopPropagation","preventDefault","currentTarget","focus","folders","files","concat","lastCheckbox","prevIndex","currentIndex","currentSelection","slice","reducedCurrentSelection","item","uppy","restrictionError","validateRestrictions","getFiles","push","info","message","opts","infoTimeout","setPluginState","id","some","promise","then","catch_","result","loading","catch","err"],"sources":["SharedHandler.js"],"sourcesContent":["import remoteFileObjToLocal from '@uppy/utils/lib/remoteFileObjToLocal'\n\nexport default class SharedHandler {\n  constructor (plugin) {\n    this.plugin = plugin\n    this.filterItems = this.filterItems.bind(this)\n    this.toggleCheckbox = this.toggleCheckbox.bind(this)\n    this.recordShiftKeyPress = this.recordShiftKeyPress.bind(this)\n    this.isChecked = this.isChecked.bind(this)\n    this.loaderWrapper = this.loaderWrapper.bind(this)\n  }\n\n  filterItems (items) {\n    const state = this.plugin.getPluginState()\n    if (!state.filterInput || state.filterInput === '') {\n      return items\n    }\n    return items.filter((folder) => {\n      return folder.name.toLowerCase().indexOf(state.filterInput.toLowerCase()) !== -1\n    })\n  }\n\n  recordShiftKeyPress (e) {\n    this.isShiftKeyPressed = e.shiftKey\n  }\n\n  /**\n   * Toggles file/folder checkbox to on/off state while updating files list.\n   *\n   * Note that some extra complexity comes from supporting shift+click to\n   * toggle multiple checkboxes at once, which is done by getting all files\n   * in between last checked file and current one.\n   */\n  toggleCheckbox (e, file) {\n    e.stopPropagation()\n    e.preventDefault()\n    e.currentTarget.focus()\n    const { folders, files } = this.plugin.getPluginState()\n    const items = this.filterItems(folders.concat(files))\n    // Shift-clicking selects a single consecutive list of items\n    // starting at the previous click and deselects everything else.\n    if (this.lastCheckbox && this.isShiftKeyPressed) {\n      const prevIndex = items.indexOf(this.lastCheckbox)\n      const currentIndex = items.indexOf(file)\n      const currentSelection = (prevIndex < currentIndex)\n        ? items.slice(prevIndex, currentIndex + 1)\n        : items.slice(currentIndex, prevIndex + 1)\n      const reducedCurrentSelection = []\n\n      // Check restrictions on each file in currentSelection,\n      // reduce it to only contain files that pass restrictions\n      for (const item of currentSelection) {\n        const { uppy } = this.plugin\n        const restrictionError = uppy.validateRestrictions(\n          remoteFileObjToLocal(item),\n          [...uppy.getFiles(), ...reducedCurrentSelection],\n        )\n\n        if (!restrictionError) {\n          reducedCurrentSelection.push(item)\n        } else {\n          uppy.info({ message: restrictionError.message }, 'error', uppy.opts.infoTimeout)\n        }\n      }\n      this.plugin.setPluginState({ currentSelection: reducedCurrentSelection })\n      return\n    }\n\n    this.lastCheckbox = file\n    const { currentSelection } = this.plugin.getPluginState()\n    if (this.isChecked(file)) {\n      this.plugin.setPluginState({\n        currentSelection: currentSelection.filter((item) => item.id !== file.id),\n      })\n    } else {\n      this.plugin.setPluginState({\n        currentSelection: currentSelection.concat([file]),\n      })\n    }\n  }\n\n  isChecked (file) {\n    const { currentSelection } = this.plugin.getPluginState()\n    // comparing id instead of the file object, because the reference to the object\n    // changes when we switch folders, and the file list is updated\n    return currentSelection.some((item) => item.id === file.id)\n  }\n\n  loaderWrapper (promise, then, catch_) {\n    promise\n      .then((result) => {\n        this.plugin.setPluginState({ loading: false })\n        then(result)\n      }).catch((err) => {\n        this.plugin.setPluginState({ loading: false })\n        catch_(err)\n      })\n    this.plugin.setPluginState({ loading: true })\n  }\n}\n"],"mappings":"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"}