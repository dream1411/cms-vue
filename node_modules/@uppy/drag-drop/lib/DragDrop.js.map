{"version":3,"names":["UIPlugin","toArray","isDragDropSupported","getDroppedFiles","h","packageJson","locale","DragDrop","constructor","uppy","opts","handleDrop","event","preventDefault","stopPropagation","clearTimeout","removeDragOverClassTimeout","setPluginState","isDraggingOver","logDropError","error","log","files","dataTransfer","length","addFiles","onDrop","type","id","title","defaultLocale","defaultOpts","target","inputName","width","height","note","i18nInit","onInputChange","bind","handleDragOver","handleDragLeave","render","descriptors","map","file","source","name","data","meta","relativePath","err","value","types","hasFiles","some","allowNewUpload","getState","dropEffect","onDragOver","setTimeout","onDragLeave","renderHiddenFileInput","restrictions","ref","fileInputRef","maxNumberOfFiles","allowedFileTypes","renderArrowSvg","renderLabel","i18nArray","browse","i18n","renderNote","dragDropClass","getPluginState","dragDropStyle","click","install","mount","uninstall","unmount","VERSION","version"],"sources":["DragDrop.jsx"],"sourcesContent":["import { UIPlugin } from '@uppy/core'\nimport toArray from '@uppy/utils/lib/toArray'\nimport isDragDropSupported from '@uppy/utils/lib/isDragDropSupported'\nimport getDroppedFiles from '@uppy/utils/lib/getDroppedFiles'\nimport { h } from 'preact'\n\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\n/**\n * Drag & Drop plugin\n *\n */\nexport default class DragDrop extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.type = 'acquirer'\n    this.id = this.opts.id || 'DragDrop'\n    this.title = 'Drag & Drop'\n\n    this.defaultLocale = locale\n\n    // Default options, must be kept in sync with @uppy/react/src/DragDrop.js.\n    const defaultOpts = {\n      target: null,\n      inputName: 'files[]',\n      width: '100%',\n      height: '100%',\n      note: null,\n    }\n\n    // Merge default options with the ones set by user\n    this.opts = { ...defaultOpts, ...opts }\n\n    this.i18nInit()\n\n    // Check for browser dragDrop support\n    this.isDragDropSupported = isDragDropSupported()\n    this.removeDragOverClassTimeout = null\n\n    // Bind `this` to class methods\n    this.onInputChange = this.onInputChange.bind(this)\n    this.handleDragOver = this.handleDragOver.bind(this)\n    this.handleDragLeave = this.handleDragLeave.bind(this)\n    this.handleDrop = this.handleDrop.bind(this)\n    this.addFiles = this.addFiles.bind(this)\n    this.render = this.render.bind(this)\n  }\n\n  addFiles (files) {\n    const descriptors = files.map((file) => ({\n      source: this.id,\n      name: file.name,\n      type: file.type,\n      data: file,\n      meta: {\n        // path of the file relative to the ancestor directory the user selected.\n        // e.g. 'docs/Old Prague/airbnb.pdf'\n        relativePath: file.relativePath || null,\n      },\n    }))\n\n    try {\n      this.uppy.addFiles(descriptors)\n    } catch (err) {\n      this.uppy.log(err)\n    }\n  }\n\n  onInputChange (event) {\n    const files = toArray(event.target.files)\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files selected through input')\n      this.addFiles(files)\n    }\n\n    // We clear the input after a file is selected, because otherwise\n    // change event is not fired in Chrome and Safari when a file\n    // with the same name is selected.\n    // ___Why not use value=\"\" on <input/> instead?\n    //    Because if we use that method of clearing the input,\n    //    Chrome will not trigger change if we drop the same file twice (Issue #768).\n    // eslint-disable-next-line no-param-reassign\n    event.target.value = null\n  }\n\n  handleDragOver (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    // Check if the \"type\" of the datatransfer object includes files. If not, deny drop.\n    const { types } = event.dataTransfer\n    const hasFiles = types.some(type => type === 'Files')\n    const { allowNewUpload } = this.uppy.getState()\n    if (!hasFiles || !allowNewUpload) {\n      // eslint-disable-next-line no-param-reassign\n      event.dataTransfer.dropEffect = 'none'\n      clearTimeout(this.removeDragOverClassTimeout)\n      return\n    }\n\n    // Add a small (+) icon on drop\n    // (and prevent browsers from interpreting this as files being _moved_ into the browser\n    // https://github.com/transloadit/uppy/issues/1978)\n    //\n    // eslint-disable-next-line no-param-reassign\n    event.dataTransfer.dropEffect = 'copy'\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    this.setPluginState({ isDraggingOver: true })\n\n    this.opts.onDragOver?.(event)\n  }\n\n  handleDragLeave (event) {\n    event.preventDefault()\n    event.stopPropagation()\n\n    clearTimeout(this.removeDragOverClassTimeout)\n    // Timeout against flickering, this solution is taken from drag-drop library.\n    // Solution with 'pointer-events: none' didn't work across browsers.\n    this.removeDragOverClassTimeout = setTimeout(() => {\n      this.setPluginState({ isDraggingOver: false })\n    }, 50)\n\n    this.opts.onDragLeave?.(event)\n  }\n\n  handleDrop = async (event) => {\n    event.preventDefault()\n    event.stopPropagation()\n    clearTimeout(this.removeDragOverClassTimeout)\n\n    // Remove dragover class\n    this.setPluginState({ isDraggingOver: false })\n\n    const logDropError = (error) => {\n      this.uppy.log(error, 'error')\n    }\n\n    // Add all dropped files\n    const files = await getDroppedFiles(event.dataTransfer, { logDropError })\n    if (files.length > 0) {\n      this.uppy.log('[DragDrop] Files dropped')\n      this.addFiles(files)\n    }\n\n    this.opts.onDrop?.(event)\n  }\n\n  renderHiddenFileInput () {\n    const { restrictions } = this.uppy.opts\n    return (\n      <input\n        className=\"uppy-DragDrop-input\"\n        type=\"file\"\n        hidden\n        ref={(ref) => { this.fileInputRef = ref }}\n        name={this.opts.inputName}\n        multiple={restrictions.maxNumberOfFiles !== 1}\n        accept={restrictions.allowedFileTypes}\n        onChange={this.onInputChange}\n      />\n    )\n  }\n\n  static renderArrowSvg () {\n    return (\n      <svg aria-hidden=\"true\" focusable=\"false\" className=\"uppy-c-icon uppy-DragDrop-arrow\" width=\"16\" height=\"16\" viewBox=\"0 0 16 16\">\n        <path d=\"M11 10V0H5v10H2l6 6 6-6h-3zm0 0\" fillRule=\"evenodd\" />\n      </svg>\n    )\n  }\n\n  renderLabel () {\n    return (\n      <div className=\"uppy-DragDrop-label\">\n        {this.i18nArray('dropHereOr', {\n          browse: <span className=\"uppy-DragDrop-browse\">{this.i18n('browse')}</span>,\n        })}\n      </div>\n    )\n  }\n\n  renderNote () {\n    return (\n      <span className=\"uppy-DragDrop-note\">{this.opts.note}</span>\n    )\n  }\n\n  render () {\n    const dragDropClass = `uppy-u-reset\n      uppy-DragDrop-container\n      ${this.isDragDropSupported ? 'uppy-DragDrop--isDragDropSupported' : ''}\n      ${this.getPluginState().isDraggingOver ? 'uppy-DragDrop--isDraggingOver' : ''}\n    `\n\n    const dragDropStyle = {\n      width: this.opts.width,\n      height: this.opts.height,\n    }\n\n    return (\n      <button\n        type=\"button\"\n        className={dragDropClass}\n        style={dragDropStyle}\n        onClick={() => this.fileInputRef.click()}\n        onDragOver={this.handleDragOver}\n        onDragLeave={this.handleDragLeave}\n        onDrop={this.handleDrop}\n      >\n        {this.renderHiddenFileInput()}\n        <div className=\"uppy-DragDrop-inner\">\n          {DragDrop.renderArrowSvg()}\n          {this.renderLabel()}\n          {this.renderNote()}\n        </div>\n      </button>\n    )\n  }\n\n  install () {\n    const { target } = this.opts\n\n    this.setPluginState({\n      isDraggingOver: false,\n    })\n\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    this.unmount()\n  }\n}\n"],"mappings":"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"}