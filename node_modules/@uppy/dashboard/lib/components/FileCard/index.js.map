{"version":3,"names":["h","Component","classNames","nanoid","getFileTypeIcon","ignoreEvent","FilePreview","FileCard","constructor","props","form","document","createElement","updateMeta","newVal","name","setState","formState","handleSave","e","preventDefault","fileID","fileCardFor","saveFileCard","state","handleCancel","file","files","uppy","emit","toggleFileCard","saveOnEnter","ev","keyCode","stopPropagation","id","renderMetaFields","metaFields","getMetaFields","fieldCSSClasses","text","map","field","required","requiredMetaFields","includes","render","undefined","value","onChange","type","placeholder","HTMLInputElement","prototype","target","storedMetaData","forEach","meta","componentWillMount","addEventListener","body","appendChild","componentWillUnmount","removeEventListener","removeChild","showEditButton","canEditFile","className","i18nArray","i18n","backgroundColor","color","event","openFileEditor","HTMLButtonElement"],"sources":["index.jsx"],"sourcesContent":["import {  h, Component  } from 'preact'\nimport classNames from 'classnames'\nimport {  nanoid  } from 'nanoid/non-secure'\nimport getFileTypeIcon from '../../utils/getFileTypeIcon.jsx'\nimport ignoreEvent from '../../utils/ignoreEvent.js'\nimport FilePreview from '../FilePreview.jsx'\n\nclass FileCard extends Component {\n  form = document.createElement('form')\n\n  constructor (props) {\n    super(props)\n\n    const file = this.props.files[this.props.fileCardFor]\n    const metaFields = this.getMetaFields() || []\n\n    const storedMetaData = {}\n    metaFields.forEach((field) => {\n      storedMetaData[field.id] = file.meta[field.id] || ''\n    })\n\n    this.state = {\n      formState: storedMetaData,\n    }\n\n    this.form.id = nanoid()\n  }\n\n  // TODO(aduh95): move this to `UNSAFE_componentWillMount` when updating to Preact X+.\n  componentWillMount () { // eslint-disable-line react/no-deprecated\n    this.form.addEventListener('submit', this.handleSave)\n    document.body.appendChild(this.form)\n  }\n\n  componentWillUnmount () {\n    this.form.removeEventListener('submit', this.handleSave)\n    document.body.removeChild(this.form)\n  }\n\n  getMetaFields () {\n    return typeof this.props.metaFields === 'function'\n      ? this.props.metaFields(this.props.files[this.props.fileCardFor])\n      : this.props.metaFields\n  }\n\n  updateMeta = (newVal, name) => {\n    this.setState(({ formState }) => ({\n      formState: {\n        ...formState,\n        [name]: newVal,\n      },\n    }))\n  }\n\n  handleSave = (e) => {\n    e.preventDefault()\n    const fileID = this.props.fileCardFor\n    this.props.saveFileCard(this.state.formState, fileID)\n  }\n\n  handleCancel = () => {\n    const file = this.props.files[this.props.fileCardFor]\n    this.props.uppy.emit('file-editor:cancel', file)\n    this.props.toggleFileCard(false)\n  }\n\n  saveOnEnter = (ev) => {\n    if (ev.keyCode === 13) {\n      ev.stopPropagation()\n      ev.preventDefault()\n      const file = this.props.files[this.props.fileCardFor]\n      this.props.saveFileCard(this.state.formState, file.id)\n    }\n  }\n\n  renderMetaFields = () => {\n    const metaFields = this.getMetaFields() || []\n    const fieldCSSClasses = {\n      text: 'uppy-u-reset uppy-c-textInput uppy-Dashboard-FileCard-input',\n    }\n\n    return metaFields.map((field) => {\n      const id = `uppy-Dashboard-FileCard-input-${field.id}`\n      const required = this.props.requiredMetaFields.includes(field.id)\n      return (\n        <fieldset key={field.id} className=\"uppy-Dashboard-FileCard-fieldset\">\n          <label className=\"uppy-Dashboard-FileCard-label\" htmlFor={id}>{field.name}</label>\n          {field.render !== undefined\n            ? field.render({\n              value: this.state.formState[field.id],\n              onChange: (newVal) => this.updateMeta(newVal, field.id),\n              fieldCSSClasses,\n              required,\n              form: this.form.id,\n            }, h)\n            : (\n              <input\n                className={fieldCSSClasses.text}\n                id={id}\n                form={this.form.id}\n                type={field.type || 'text'}\n                required={required}\n                value={this.state.formState[field.id]}\n                placeholder={field.placeholder}\n                // If `form` attribute is not supported, we need to capture pressing Enter to avoid bubbling in case Uppy is\n                // embedded inside a <form>.\n                onKeyUp={'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter}\n                onKeyDown={'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter}\n                onKeyPress={'form' in HTMLInputElement.prototype ? undefined : this.saveOnEnter}\n                onInput={ev => this.updateMeta(ev.target.value, field.id)}\n                data-uppy-super-focusable\n              />\n            )}\n        </fieldset>\n      )\n    })\n  }\n\n  render () {\n    const file = this.props.files[this.props.fileCardFor]\n    const showEditButton = this.props.canEditFile(file)\n\n    return (\n      <div\n        className={classNames('uppy-Dashboard-FileCard', this.props.className)}\n        data-uppy-panelType=\"FileCard\"\n        onDragOver={ignoreEvent}\n        onDragLeave={ignoreEvent}\n        onDrop={ignoreEvent}\n        onPaste={ignoreEvent}\n      >\n        <div className=\"uppy-DashboardContent-bar\">\n          <div className=\"uppy-DashboardContent-title\" role=\"heading\" aria-level=\"1\">\n            {this.props.i18nArray('editing', {\n              file: <span className=\"uppy-DashboardContent-titleFile\">{file.meta ? file.meta.name : file.name}</span>,\n            })}\n          </div>\n          <button\n            className=\"uppy-DashboardContent-back\"\n            type=\"button\"\n            form={this.form.id}\n            title={this.props.i18n('finishEditingFile')}\n            onClick={this.handleCancel}\n          >\n            {this.props.i18n('cancel')}\n          </button>\n        </div>\n\n        <div className=\"uppy-Dashboard-FileCard-inner\">\n          <div className=\"uppy-Dashboard-FileCard-preview\" style={{ backgroundColor: getFileTypeIcon(file.type).color }}>\n            <FilePreview file={file} />\n            {showEditButton\n              && (\n              <button\n                type=\"button\"\n                className=\"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit\"\n                onClick={(event) => {\n                  // When opening the image editor we want to save any meta fields changes.\n                  // Otherwise it's confusing for the user to click save in the editor,\n                  // but the changes here are discarded. This bypasses validation,\n                  // but we are okay with that.\n                  this.handleSave(event)\n                  this.props.openFileEditor(file)\n                }}\n                form={this.form.id}\n              >\n                {this.props.i18n('editFile')}\n              </button>\n              )}\n          </div>\n\n          <div className=\"uppy-Dashboard-FileCard-info\">\n            {this.renderMetaFields()}\n          </div>\n\n          <div className=\"uppy-Dashboard-FileCard-actions\">\n            <button\n              className=\"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn\"\n              // If `form` attribute is supported, we want a submit button to trigger the form validation.\n              // Otherwise, fallback to a classic button with a onClick event handler.\n              type={'form' in HTMLButtonElement.prototype ? 'submit' : 'button'}\n              onClick={'form' in HTMLButtonElement.prototype ? undefined : this.handleSave}\n              form={this.form.id}\n            >\n              {this.props.i18n('saveChanges')}\n            </button>\n            <button\n              className=\"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn\"\n              type=\"button\"\n              onClick={this.handleCancel}\n              form={this.form.id}\n            >\n              {this.props.i18n('cancel')}\n            </button>\n          </div>\n        </div>\n      </div>\n    )\n  }\n}\n\nexport default FileCard\n"],"mappings":"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"}