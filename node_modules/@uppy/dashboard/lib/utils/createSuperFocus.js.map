{"version":3,"names":["debounce","FOCUSABLE_ELEMENTS","getActiveOverlayEl","createSuperFocus","lastFocusWasOnSuperFocusableEl","superFocus","dashboardEl","activeOverlayType","overlayEl","isFocusInOverlay","contains","document","activeElement","superFocusableEl","querySelector","focus","preventScroll","firstEl"],"sources":["createSuperFocus.js"],"sourcesContent":["import debounce from 'lodash.debounce'\nimport FOCUSABLE_ELEMENTS from '@uppy/utils/lib/FOCUSABLE_ELEMENTS'\nimport getActiveOverlayEl from './getActiveOverlayEl.js'\n\n/*\n  Focuses on some element in the currently topmost overlay.\n\n  1. If there are some [data-uppy-super-focusable] elements rendered already - focuses\n     on the first superfocusable element, and leaves focus up to the control of\n     a user (until currently focused element disappears from the screen [which\n     can happen when overlay changes, or, e.g., when we click on a folder in googledrive]).\n  2. If there are no [data-uppy-super-focusable] elements yet (or ever) - focuses\n     on the first focusable element, but switches focus if superfocusable elements appear on next render.\n*/\nexport default function createSuperFocus () {\n  let lastFocusWasOnSuperFocusableEl = false\n\n  const superFocus = (dashboardEl, activeOverlayType) => {\n    const overlayEl = getActiveOverlayEl(dashboardEl, activeOverlayType)\n\n    const isFocusInOverlay = overlayEl.contains(document.activeElement)\n    // If focus is already in the topmost overlay, AND on last update we focused on the superfocusable\n    // element - then leave focus up to the user.\n    // [Practical check] without this line, typing in the search input in googledrive overlay won't work.\n    if (isFocusInOverlay && lastFocusWasOnSuperFocusableEl) return\n\n    const superFocusableEl = overlayEl.querySelector('[data-uppy-super-focusable]')\n    // If we are already in the topmost overlay, AND there are no super focusable elements yet, - leave focus up to the user.\n    // [Practical check] without this line, if you are in an empty folder in google drive, and something's uploading in the\n    // bg, - focus will be jumping to Done all the time.\n    if (isFocusInOverlay && !superFocusableEl) return\n\n    if (superFocusableEl) {\n      superFocusableEl.focus({ preventScroll: true })\n      lastFocusWasOnSuperFocusableEl = true\n    } else {\n      const firstEl = overlayEl.querySelector(FOCUSABLE_ELEMENTS)\n      firstEl?.focus({ preventScroll: true })\n      lastFocusWasOnSuperFocusableEl = false\n    }\n  }\n\n  // ___Why do we need to debounce?\n  //    1. To deal with animations: overlay changes via animations, which results in the DOM updating AFTER plugin.update()\n  //       already executed.\n  //    [Practical check] without debounce, if we open the Url overlay, and click 'Done', Dashboard won't get focused again.\n  //    [Practical check] if we delay 250ms instead of 260ms - IE11 won't get focused in same situation.\n  //    2. Performance: there can be many state update()s in a second, and this function is called every time.\n  return debounce(superFocus, 260)\n}\n"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,iBAArB;AACA,OAAOC,kBAAP,MAA+B,oCAA/B;AACA,OAAOC,kBAAP,MAA+B,yBAA/B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,eAAe,SAASC,gBAAT,GAA6B;EAC1C,IAAIC,8BAA8B,GAAG,KAArC;;EAEA,MAAMC,UAAU,GAAG,CAACC,WAAD,EAAcC,iBAAd,KAAoC;IACrD,MAAMC,SAAS,GAAGN,kBAAkB,CAACI,WAAD,EAAcC,iBAAd,CAApC;IAEA,MAAME,gBAAgB,GAAGD,SAAS,CAACE,QAAV,CAAmBC,QAAQ,CAACC,aAA5B,CAAzB,CAHqD,CAIrD;IACA;IACA;;IACA,IAAIH,gBAAgB,IAAIL,8BAAxB,EAAwD;IAExD,MAAMS,gBAAgB,GAAGL,SAAS,CAACM,aAAV,CAAwB,6BAAxB,CAAzB,CATqD,CAUrD;IACA;IACA;;IACA,IAAIL,gBAAgB,IAAI,CAACI,gBAAzB,EAA2C;;IAE3C,IAAIA,gBAAJ,EAAsB;MACpBA,gBAAgB,CAACE,KAAjB,CAAuB;QAAEC,aAAa,EAAE;MAAjB,CAAvB;MACAZ,8BAA8B,GAAG,IAAjC;IACD,CAHD,MAGO;MACL,MAAMa,OAAO,GAAGT,SAAS,CAACM,aAAV,CAAwBb,kBAAxB,CAAhB;MACAgB,OAAO,QAAP,YAAAA,OAAO,CAAEF,KAAT,CAAe;QAAEC,aAAa,EAAE;MAAjB,CAAf;MACAZ,8BAA8B,GAAG,KAAjC;IACD;EACF,CAvBD,CAH0C,CA4B1C;EACA;EACA;EACA;EACA;EACA;;;EACA,OAAOJ,QAAQ,CAACK,UAAD,EAAa,GAAb,CAAf;AACD"}