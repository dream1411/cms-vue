{"version":3,"names":["UIPlugin","h","Editor","packageJson","locale","ImageEditor","constructor","uppy","opts","save","saveBlobCallback","blob","currentImage","getPluginState","setFileState","id","data","size","preview","updatedFile","getFile","emit","setPluginState","cropper","getCroppedCanvas","cropperOptions","croppedCanvasOptions","toBlob","type","quality","storeCropperInstance","selectFile","file","title","defaultLocale","defaultCropperOptions","viewMode","background","autoCropArea","responsive","defaultActions","revert","rotate","granularRotate","flip","zoomIn","zoomOut","cropSquare","cropWidescreen","cropWidescreenVertical","defaultOptions","actions","i18nInit","canEditFile","isRemote","fileTypeSpecific","split","test","install","target","mount","uninstall","unmount","render","i18n","VERSION","version"],"sources":["ImageEditor.jsx"],"sourcesContent":["import { UIPlugin } from '@uppy/core'\nimport { h } from 'preact'\n\nimport Editor from './Editor.jsx'\nimport packageJson from '../package.json'\nimport locale from './locale.js'\n\nexport default class ImageEditor extends UIPlugin {\n  static VERSION = packageJson.version\n\n  constructor (uppy, opts) {\n    super(uppy, opts)\n    this.id = this.opts.id || 'ImageEditor'\n    this.title = 'Image Editor'\n    this.type = 'editor'\n\n    this.defaultLocale = locale\n\n    const defaultCropperOptions = {\n      viewMode: 1,\n      background: false,\n      autoCropArea: 1,\n      responsive: true,\n      croppedCanvasOptions: {},\n    }\n\n    const defaultActions = {\n      revert: true,\n      rotate: true,\n      granularRotate: true,\n      flip: true,\n      zoomIn: true,\n      zoomOut: true,\n      cropSquare: true,\n      cropWidescreen: true,\n      cropWidescreenVertical: true,\n    }\n\n    const defaultOptions = {\n      quality: 0.8,\n    }\n\n    this.opts = {\n      ...defaultOptions,\n      ...opts,\n      actions: {\n        ...defaultActions,\n        ...opts.actions,\n      },\n      cropperOptions: {\n        ...defaultCropperOptions,\n        ...opts.cropperOptions,\n      },\n    }\n\n    this.i18nInit()\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  canEditFile (file) {\n    if (!file.type || file.isRemote) {\n      return false\n    }\n\n    const fileTypeSpecific = file.type.split('/')[1]\n\n    if (/^(jpe?g|gif|png|bmp|webp)$/.test(fileTypeSpecific)) {\n      return true\n    }\n\n    return false\n  }\n\n  save = () => {\n    const saveBlobCallback = (blob) => {\n      const { currentImage } = this.getPluginState()\n\n      this.uppy.setFileState(currentImage.id, {\n        data: blob,\n        size: blob.size,\n        preview: null,\n      })\n\n      const updatedFile = this.uppy.getFile(currentImage.id)\n      this.uppy.emit('thumbnail:request', updatedFile)\n      this.setPluginState({\n        currentImage: updatedFile,\n      })\n      this.uppy.emit('file-editor:complete', updatedFile)\n    }\n\n    const { currentImage } = this.getPluginState()\n\n    this.cropper.getCroppedCanvas(this.opts.cropperOptions.croppedCanvasOptions).toBlob(\n      saveBlobCallback,\n      currentImage.type,\n      this.opts.quality,\n    )\n  }\n\n  storeCropperInstance = (cropper) => {\n    this.cropper = cropper\n  }\n\n  selectFile = (file) => {\n    this.uppy.emit('file-editor:start', file)\n    this.setPluginState({\n      currentImage: file,\n    })\n  }\n\n  install () {\n    this.setPluginState({\n      currentImage: null,\n    })\n\n    const { target } = this.opts\n    if (target) {\n      this.mount(target, this)\n    }\n  }\n\n  uninstall () {\n    const { currentImage } = this.getPluginState()\n\n    if (currentImage) {\n      const file = this.uppy.getFile(currentImage.id)\n      this.uppy.emit('file-editor:cancel', file)\n    }\n    this.unmount()\n  }\n\n  render () {\n    const { currentImage } = this.getPluginState()\n\n    if (currentImage === null || currentImage.isRemote) {\n      return null\n    }\n\n    return (\n      <Editor\n        currentImage={currentImage}\n        storeCropperInstance={this.storeCropperInstance}\n        save={this.save}\n        opts={this.opts}\n        i18n={this.i18n}\n      />\n    )\n  }\n}\n"],"mappings":"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"}